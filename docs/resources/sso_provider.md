---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "archestra_sso_provider Resource - archestra"
subcategory: ""
description: |-
  Manages Archestra SSO providers (OIDC or SAML). Exactly one of oidc_config or saml_config must be set.
---

# archestra_sso_provider (Resource)

Manages Archestra SSO providers (OIDC or SAML). Exactly one of oidc_config or saml_config must be set.

## Example Usage

```terraform
# OIDC provider example (Keycloak / Generic OAuth)
resource "archestra_sso_provider" "oidc" {
  provider_id = "Keycloak"
  domain      = "example.com"
  issuer      = "https://keycloak.example.com/realms/main"

  oidc_config {
    issuer             = "https://keycloak.example.com/realms/main"
    discovery_endpoint = "https://keycloak.example.com/realms/main/.well-known/openid-configuration"
    client_id          = "archestra"
    client_secret      = "changeme"
    scopes             = ["openid", "email", "profile"]
    pkce               = false

    mapping {
      name  = "name"
      email = "email"
      image = "picture"
    }
  }

  role_mapping {
    default_role = "member"
    rules = [{
      expression = "{{#includes groups \"archestra-admins\"}}true{{/includes}}"
      role       = "admin"
    }]
  }
}

# SAML provider example (Okta SAML)
resource "archestra_sso_provider" "saml" {
  provider_id = "OktaSAML"
  domain      = "example.com"
  issuer      = "https://example.com"

  saml_config {
    issuer            = "https://example.com"
    entry_point       = "https://okta.example.com/app/sso/saml"
    callback_url      = "https://archestra.example.com/api/auth/sso/saml2/sp/acs/OktaSAML"
    cert              = "-----BEGIN CERTIFICATE-----\nMIICiTCCAg+gAwIBAgIJAJ8l4HnPq7F8MAOGA1UEBhMCVVMxCzAJBgNVBAgTAkNB\nMRYwFAYDVQQHEw1TYW4gRnJhbmNpc2NvMRowGAYDVQQKExFPcGVuQU1QIFNhbXBs\nZSBDb21wYW55IENBMRYwFAYDVQQDEx1vcGVuYW1wLmV4YW1wbGUuY29tMB4XDTE0\nMDgxOTE2MjQyNVoXDTIyMDgxODE2MjQyNVowdTELMAkGA1UEBhMCVVMxCzAJBgNV\nBAgTAkNBMRYwFAYDVQQHEw1TYW4gRnJhbmNpc2NvMRowGAYDVQQKExFPcGVuQU1Q\nIFNhbXBsZSBDb21wYW55IENBMRYwFAYDVQQDEx1vcGVuYW1wLmV4YW1wbGUuY29t\nMFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBANgOqCbLsKv5CF+vGmJ9Vq5PJKKuiU8+\nLpqtHKHC9q3mRWxHF8dlE8j9D6Kz+N+CK+qGzFjWNBT3UVFzU5GJUYCAwEAAaNQ\nME4wHQYDVR0OBBYEFG7CJM9GjHn7Lqt8kJc8W5proUwWMB8GA1UdIwQYMBaAFG7C\nJM9GjHn7Lqt8kJc8W5proUwWMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQEFBQAD\nggEBABYIUUUeWDJ+wZF0lZ+mJnRnGZpXL2fKe3+KGjNM8xJfPf2YvqU4mgdMxgJn\n-----END CERTIFICATE-----"
    audience          = "https://archestra.example.com"
    digest_algorithm  = "sha256"
    identifier_format = "urn:oasis:names:tc:SAML:2.0:nameid-format:persistent"

    idp_metadata {
      entity_id = "https://okta.example.com"
      metadata  = "<?xml version=\"1.0\" encoding=\"UTF-8\"?><EntityDescriptor xmlns=\"urn:oasis:names:tc:SAML:2.0:metadata\" entityID=\"https://okta.example.com\"><IDPSSODescriptor protocolSupportEnumeration=\"urn:oasis:names:tc:SAML:2.0:protocol\"><SingleSignOnService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect\" Location=\"https://okta.example.com/app/sso/saml\"/></IDPSSODescriptor></EntityDescriptor>"

      single_sign_on_service {
        binding  = "urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect"
        location = "https://okta.example.com/app/sso/saml"
      }
    }

    sp_metadata {
      entity_id = "https://archestra.example.com"
      metadata  = "<?xml version=\"1.0\" encoding=\"UTF-8\"?><EntityDescriptor xmlns=\"urn:oasis:names:tc:SAML:2.0:metadata\" entityID=\"https://archestra.example.com\"><SPSSODescriptor protocolSupportEnumeration=\"urn:oasis:names:tc:SAML:2.0:protocol\"><AssertionConsumerService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST\" Location=\"https://archestra.example.com/api/auth/sso/saml2/sp/acs/OktaSAML\" index=\"0\" isDefault=\"true\"/></SPSSODescriptor></EntityDescriptor>"
    }

    mapping {
      email      = "email"
      first_name = "firstName"
      last_name  = "lastName"
      name       = "name"
      id         = "employeeId"
    }
  }

  role_mapping {
    default_role = "member"
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `domain` (String) Organization domain associated with this provider.
- `issuer` (String) Issuer for this provider (OIDC issuer URL or SAML entity ID).
- `provider_id` (String) Unique provider identifier (e.g. Okta, Google, Keycloak).

### Optional

- `oidc_config` (Block, Optional) OIDC configuration (cannot be set with saml_config). (see [below for nested schema](#nestedblock--oidc_config))
- `role_mapping` (Block, Optional) Optional role mapping rules using Handlebars expressions. (see [below for nested schema](#nestedblock--role_mapping))
- `saml_config` (Block, Optional) SAML configuration (cannot be set with oidc_config). (see [below for nested schema](#nestedblock--saml_config))

### Read-Only

- `domain_verified` (Boolean) Whether the domain has been verified.
- `id` (String) SSO provider identifier
- `organization_id` (String) Organization ID for the provider.
- `user_id` (String) User who created the provider.

<a id="nestedblock--oidc_config"></a>
### Nested Schema for `oidc_config`

Optional:

- `authorization_endpoint` (String) Override authorization endpoint.
- `client_id` (String) OIDC client ID.
- `client_secret` (String, Sensitive) OIDC client secret.
- `discovery_endpoint` (String) Discovery endpoint (.well-known).
- `issuer` (String) OIDC issuer URL.
- `jwks_endpoint` (String) Override JWKS endpoint.
- `mapping` (Block, Optional) Attribute mapping for user fields. (see [below for nested schema](#nestedblock--oidc_config--mapping))
- `override_user_info` (Boolean) Use token claims instead of userinfo when true.
- `pkce` (Boolean) Enable PKCE.
- `scopes` (List of String) OAuth scopes to request.
- `token_endpoint` (String) Override token endpoint.
- `token_endpoint_authentication` (String) Token endpoint auth method (client_secret_basic or client_secret_post).
- `user_info_endpoint` (String) Override user info endpoint.

<a id="nestedblock--oidc_config--mapping"></a>
### Nested Schema for `oidc_config.mapping`

Optional:

- `email` (String)
- `email_verified` (String)
- `extra_fields` (Map of String)
- `id` (String)
- `image` (String)
- `name` (String)



<a id="nestedblock--role_mapping"></a>
### Nested Schema for `role_mapping`

Optional:

- `default_role` (String)
- `rules` (Attributes List) (see [below for nested schema](#nestedatt--role_mapping--rules))
- `skip_role_sync` (Boolean)
- `strict_mode` (Boolean)

<a id="nestedatt--role_mapping--rules"></a>
### Nested Schema for `role_mapping.rules`

Required:

- `expression` (String)
- `role` (String)



<a id="nestedblock--saml_config"></a>
### Nested Schema for `saml_config`

Optional:

- `audience` (String)
- `callback_url` (String) ACS callback URL.
- `cert` (String, Sensitive) IdP certificate (X.509).
- `decryption_pvk` (String, Sensitive)
- `digest_algorithm` (String)
- `entry_point` (String) IdP SSO entry point URL.
- `identifier_format` (String)
- `idp_metadata` (Block, Optional) IdP metadata details. (see [below for nested schema](#nestedblock--saml_config--idp_metadata))
- `issuer` (String) SAML issuer/entity ID.
- `mapping` (Block, Optional) Attribute mapping for user fields. (see [below for nested schema](#nestedblock--saml_config--mapping))
- `private_key` (String, Sensitive)
- `signature_algorithm` (String)
- `sp_metadata` (Block, Optional) SP metadata details. (see [below for nested schema](#nestedblock--saml_config--sp_metadata))
- `want_assertions_signed` (Boolean)

<a id="nestedblock--saml_config--idp_metadata"></a>
### Nested Schema for `saml_config.idp_metadata`

Optional:

- `cert` (String, Sensitive)
- `enc_private_key` (String, Sensitive)
- `enc_private_key_pass` (String, Sensitive)
- `entity_id` (String)
- `entity_url` (String)
- `is_assertion_encrypted` (Boolean)
- `metadata` (String)
- `private_key` (String, Sensitive)
- `private_key_pass` (String, Sensitive)
- `redirect_url` (String)
- `single_sign_on_service` (Block List) (see [below for nested schema](#nestedblock--saml_config--idp_metadata--single_sign_on_service))

<a id="nestedblock--saml_config--idp_metadata--single_sign_on_service"></a>
### Nested Schema for `saml_config.idp_metadata.single_sign_on_service`

Required:

- `binding` (String)
- `location` (String)



<a id="nestedblock--saml_config--mapping"></a>
### Nested Schema for `saml_config.mapping`

Optional:

- `email` (String)
- `email_verified` (String)
- `extra_fields` (Map of String)
- `first_name` (String)
- `id` (String)
- `last_name` (String)
- `name` (String)


<a id="nestedblock--saml_config--sp_metadata"></a>
### Nested Schema for `saml_config.sp_metadata`

Optional:

- `binding` (String)
- `enc_private_key` (String, Sensitive)
- `enc_private_key_pass` (String, Sensitive)
- `entity_id` (String)
- `is_assertion_encrypted` (Boolean)
- `metadata` (String)
- `private_key` (String, Sensitive)
- `private_key_pass` (String, Sensitive)
