---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "archestra_optimization_rule Resource - archestra"
subcategory: ""
description: |-
  Manages cost optimization rules in Archestra.
---

# archestra_optimization_rule (Resource)

Manages cost optimization rules in Archestra.

## Example Usage

```terraform
# Switch to cheaper model for short prompts
resource "archestra_optimization_rule" "short_prompts" {
  entity_type  = "organization"
  entity_id    = "your-organization-id"
  llm_provider = "openai"
  target_model = "gpt-4o-mini"
  enabled      = true

  conditions = [
    {
      max_length = 500 # Use cheaper model for prompts under 500 tokens
    }
  ]
}

# Use cheaper model when no tools are needed
resource "archestra_optimization_rule" "no_tools" {
  entity_type  = "organization"
  entity_id    = "your-organization-id"
  llm_provider = "anthropic"
  target_model = "claude-3-haiku-20240307"
  enabled      = true

  conditions = [
    {
      has_tools = false # Use cheaper model when no tools are present
    }
  ]
}

# Team-specific optimization rule
resource "archestra_optimization_rule" "team_optimization" {
  entity_type  = "team"
  entity_id    = archestra_team.support.id
  llm_provider = "openai"
  target_model = "gpt-4o-mini"
  enabled      = true

  conditions = [
    {
      max_length = 1000
    }
  ]
}

# Agent-specific optimization with multiple conditions
resource "archestra_optimization_rule" "agent_optimization" {
  entity_type  = "agent"
  entity_id    = archestra_agent.chatbot.id
  llm_provider = "openai"
  target_model = "gpt-4o-mini"
  enabled      = true

  conditions = [
    {
      max_length = 200
    },
    {
      has_tools = false
    }
  ]
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `conditions` (Attributes List) Conditions that trigger the optimization (see [below for nested schema](#nestedatt--conditions))
- `entity_id` (String) Entity ID this rule applies to
- `entity_type` (String) Entity type: organization, team, or agent
- `llm_provider` (String) LLM provider: openai, anthropic, or gemini
- `target_model` (String) Target model to switch to

### Optional

- `enabled` (Boolean) Whether the rule is enabled

### Read-Only

- `id` (String) Optimization rule identifier

<a id="nestedatt--conditions"></a>
### Nested Schema for `conditions`

Optional:

- `has_tools` (Boolean) Whether tools are present
- `max_length` (Number) Maximum token length threshold
