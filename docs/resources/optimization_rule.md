---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "archestra_optimization_rule Resource - archestra"
subcategory: ""
description: |-
  Manages cost optimization rules in Archestra. Optimization rules automatically switch to cheaper models based on conditions like content length or tool presence.
  Note: This resource requires the optimization rules API endpoints to be available in the generated API client. If you receive an error about API client limitations, run make codegen-api-client with the Archestra backend running.
---

# archestra_optimization_rule (Resource)

Manages cost optimization rules in Archestra. Optimization rules automatically switch to cheaper models based on conditions like content length or tool presence.

**Note**: This resource requires the optimization rules API endpoints to be available in the generated API client. If you receive an error about API client limitations, run `make codegen-api-client` with the Archestra backend running.

## Example Usage

```terraform
# Switch to cheaper model for short prompts
resource "archestra_optimization_rule" "short_prompts" {
  entity_type  = "organization"
  entity_id    = "your-organization-id"
  llm_provider = "openai"
  target_model = "gpt-4o-mini"
  enabled      = true

  conditions = [
    {
      max_length = 500 # Use cheaper model for prompts under 500 tokens
    }
  ]
}

# Use cheaper model when no tools are needed
resource "archestra_optimization_rule" "no_tools" {
  entity_type  = "organization"
  entity_id    = "your-organization-id"
  llm_provider = "anthropic"
  target_model = "claude-3-haiku-20240307"
  enabled      = true

  conditions = [
    {
      has_tools = false # Use cheaper model when no tools are present
    }
  ]
}

# Team-specific optimization rule
resource "archestra_optimization_rule" "team_optimization" {
  entity_type  = "team"
  entity_id    = archestra_team.support.id
  llm_provider = "openai"
  target_model = "gpt-4o-mini"
  enabled      = true

  conditions = [
    {
      max_length = 1000
    }
  ]
}

# Agent-specific optimization with multiple conditions
resource "archestra_optimization_rule" "agent_optimization" {
  entity_type  = "agent"
  entity_id    = archestra_agent.chatbot.id
  llm_provider = "openai"
  target_model = "gpt-4o-mini"
  enabled      = true

  conditions = [
    {
      max_length = 200
    },
    {
      has_tools = false
    }
  ]
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `conditions` (Attributes List) List of conditions that trigger the optimization. Each condition can specify either max_length (for content length) or has_tools (for tool presence). (see [below for nested schema](#nestedatt--conditions))
- `entity_id` (String) The ID of the entity this rule applies to
- `entity_type` (String) The type of entity: 'organization', 'team', or 'agent'
- `llm_provider` (String) The LLM provider: 'openai', 'anthropic', or 'gemini'
- `target_model` (String) The cheaper model to switch to when conditions are met

### Optional

- `enabled` (Boolean) Whether this optimization rule is enabled

### Read-Only

- `id` (String) Optimization rule identifier

<a id="nestedatt--conditions"></a>
### Nested Schema for `conditions`

Optional:

- `has_tools` (Boolean) Whether tools are present. If false, requests without tools will use the cheaper model.
- `max_length` (Number) Maximum token length to trigger switching to cheaper model. If the request is shorter than this, the cheaper model will be used.
